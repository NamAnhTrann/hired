<section>
  <div class="p-4">
    <div class="mt-24 max-w-[1800px] mx-auto px-4">
      <div
        class="mb-6 rounded-lg border border-dashed border-slate-300 bg-slate-50 px-6 py-4 text-sm text-slate-600 flex items-center justify-between gap-4"
      >
        <p>
          This page shows how your product will look to customers. Click on the
          highlighted areas to add your product details.
        </p>

        <a
          routerLink="/dashboard-page"
          class="shrink-0 inline-flex items-center gap-2 rounded-md border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 transition"
        >
          ← Back to dashboard
        </a>
      </div>

      <div
        class="grid items-start grid-cols-1 lg:grid-cols-2 gap-8 max-lg:gap-12 max-sm:gap-8"
      >
        <!-- LEFT: IMAGES -->
        <div class="w-full lg:sticky top-24 self-start">
          <div class="flex flex-col gap-4">
            <!-- MAIN IMAGE -->
            <div class="p-2">
              <input
                #imageInput
                type="file"
                multiple
                accept="image/*"
                class="hidden"
                (change)="onFileChange($event)"
              />

              @if (imgPreviews.length > 0) {
                <div
                  (click)="imageInput.click()"
                  class="aspect-square rounded-lg overflow-hidden border border-slate-300 cursor-pointer"
                >
                  <img
                    [src]="imgPreviews[0]"
                    class="w-full h-full object-cover"
                  />
                </div>
              } @else {
                <div
                  (click)="imageInput.click()"
                  class="w-24 sm:w-full aspect-square rounded-lg border border-dashed border-slate-300 bg-slate-100 flex items-center justify-center text-xs text-slate-400 cursor-pointer hover:bg-slate-200 transition"
                >
                  Click to add image
                </div>
              }
            </div>

            <!-- SUB IMAGES -->
            <div class="rounded-xl px-4 py-4 w-full">
              <div
                class="flex gap-3 overflow-x-auto pb-2 sm:grid sm:grid-cols-5 sm:gap-4 sm:overflow-visible"
              >
                @for (img of imgPreviews.slice(1); track img) {
                  <div
                    class="w-24 sm:w-full aspect-square rounded-lg overflow-hidden border border-slate-300"
                  >
                    <img [src]="img" class="w-full h-full object-cover" />
                  </div>
                }

                @if (imgPreviews.length < 6) {
                  <div
                    (click)="imageInput.click()"
                    class="w-24 sm:w-full aspect-square rounded-lg border border-dashed border-slate-300 bg-slate-100 flex items-center justify-center text-xs text-slate-400 cursor-pointer hover:bg-slate-200 transition"
                  >
                    +
                  </div>
                }
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT: PRODUCT INFO -->
        <form class="w-full" [formGroup]="form" (ngSubmit)="add_product()">
          <div>
            <div class="mb-4 max-w-sm">
              <div class="relative inline-block w-full">
                <select
                  formControlName="product_category"
                  class="w-full rounded-md bg-slate-200 pl-4 pr-10 py-2 text-sm text-slate-600 appearance-none focus:outline-none focus:ring-2 focus:ring-indigo-400 transition cursor-pointer"
                >
                  <option value="" disabled>Product category</option>
                  <option value="clothing">Clothing</option>
                  <option value="digital">Digital</option>
                  <option value="electronic">Electronic</option>
                  <option value="food">Food</option>
                  <option value="other">Other</option>
                </select>

                <!-- Custom arrow -->
                <span
                  class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-slate-500 text-xs"
                >
                  ▼
                </span>
              </div>

              <!-- Hint -->
              <p class="mt-1 text-xs text-slate-400">
                Select a category. This controls how your product is listed.
              </p>

              @if (
                form.controls.product_category.touched &&
                form.controls.product_category.invalid
              ) {
                <p class="text-red-500 text-xs mt-1">Must choose a category</p>
              }
            </div>
          </div>

          <input
            type="text"
            formControlName="product_title"
            placeholder="Add title here (click to add)"
            class="h-8 sm:h-9 w-3/4 rounded-md bg-slate-200 px-3 text-sm sm:text-base text-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          />

          <!-- RATING -->
          <div class="flex items-center gap-4 mt-4">
            <div
              class="h-4 w-24 py-3 rounded bg-slate-200 flex items-center justify-center text-xs text-slate-500"
            >
              Rating
            </div>

            <span class="text-slate-400">|</span>

            <div
              class="h-4 w-20 py-3 rounded bg-slate-200 flex items-center justify-center text-xs text-slate-500"
            >
              Reviews
            </div>

            <span class="text-slate-400">|</span>

            <div
              class="h-4 w-16 py-3 rounded bg-slate-200 flex items-center justify-center text-xs text-slate-500"
            >
              Likes
            </div>
          </div>

          <!-- PRICE -->
          <div class="mt-6">
            <input
              type="number"
              formControlName="product_price"
              placeholder="Add price"
              min="1"
              step="1"
              class="h-8 sm:h-9 w-3/4 rounded-md bg-slate-200 px-3 text-sm sm:text-base text-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            />
          </div>
          <p class="mt-1 text-xs text-slate-400">Enter your product price</p>

          <hr class="my-6 border-gray-300" />

          <!-- QUANTITY -->
          <div class="mt-6">
            <input
              type="number"
              formControlName="product_quantity"
              placeholder="Quantity available"
              min="1"
              step="1"
              class="h-8 sm:h-9 w-3/4 rounded-md bg-slate-200 px-3 text-sm sm:text-base text-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            />

            <p class="mt-1 text-xs text-slate-400">
              Enter how many units you have in stock.
            </p>

            @if (
              form.controls.product_quantity.touched &&
              form.controls.product_quantity.invalid
            ) {
              <p class="mt-1 text-xs text-red-500">
                Quantity must be at least 1.
              </p>
            }
          </div>

          <!-- ACTION BUTTONS -->
          <div class="mt-4 flex flex-wrap gap-4">
            <button
              class="px-5 py-3 w-full sm:w-[48%] bg-slate-200 text-slate-500 text-sm font-medium rounded-lg cursor-not-allowed"
              disabled
            >
              Add to cart
            </button>

            <button
              class="px-5 py-3 w-full sm:w-[48%] border border-slate-200 bg-slate-100 text-slate-400 text-sm font-medium rounded-lg cursor-not-allowed"
              disabled
            >
              Back to Shopping
            </button>
          </div>

          <hr class="my-6 border-slate-300" />

          <!-- PRODUCT INFO -->
          <section class="space-y-6 max-w-4xl">
            <h3 class="text-xl font-semibold text-slate-400">
              Product Information
            </h3>

            <textarea
              formControlName="product_description"
              placeholder="Add product description here"
              rows="5"
              class="w-full rounded-md bg-slate-200 p-4 text-sm sm:text-base text-slate-700 leading-relaxed resize-none focus:outline-none focus:ring-2 focus:ring-indigo-400"
            ></textarea>

            <p class="mt-3 text-xs text-slate-400">
              Product description preview
            </p>
            <h4 class="text-sm font-semibold text-slate-400 mt-8">
              Product Features
            </h4>
            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">
              @for (
                feature of form.controls.product_features.value ?? [];
                track $index;
                let i = $index
              ) {
                <li
                  class="w-3/4 rounded bg-slate-200 flex items-center px-2 py-2 text-xs text-slate-700"
                >
                  <input
                    type="text"
                    class="flex-1 bg-transparent focus:outline-none"
                    [value]="feature"
                    (input)="
                      updateItem(
                        'product_features',
                        i,
                        $any($event.target).value
                      )
                    "
                    placeholder="Product feature"
                  />

                  <button
                    type="button"
                    class="ml-2 text-red-400 hover:text-red-600"
                    (click)="removeItem('product_features', i)"
                  >
                    ✕
                  </button>
                </li>
              }

              <li>
                <button
                  type="button"
                  class="w-3/4 rounded border border-dashed border-slate-400 text-xs text-slate-500 py-2 hover:bg-slate-100"
                  (click)="addItem('product_features')"
                >
                  + Add feature
                </button>
              </li>
            </ul>
            <h4 class="text-sm font-semibold text-slate-400 mt-8">
              Shipping Information
            </h4>

            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">
              @for (
                info of form.controls.shipping_info.value ?? [];
                track $index;
                let i = $index
              ) {
                <li
                  class="w-3/4 rounded bg-slate-200 flex items-center px-2 py-2 text-xs text-slate-700"
                >
                  <input
                    type="text"
                    class="flex-1 bg-transparent focus:outline-none"
                    [value]="info"
                    (input)="
                      updateItem('shipping_info', i, $any($event.target).value)
                    "
                    placeholder="Shipping detail"
                  />

                  <button
                    type="button"
                    class="ml-2 text-red-400 hover:text-red-600"
                    (click)="removeItem('shipping_info', i)"
                  >
                    ✕
                  </button>
                </li>
              }

              <li>
                <button
                  type="button"
                  class="w-3/4 rounded border border-dashed border-slate-400 text-xs text-slate-500 py-2 hover:bg-slate-100"
                  (click)="addItem('shipping_info')"
                >
                  + Add shipping info
                </button>
              </li>
            </ul>
            <h4 class="text-sm font-semibold text-slate-400 mt-8">
              Product Policies
            </h4>

 <ul class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">
  @for (
    policy of form.controls.product_policies.value ?? [];
    track $index;
    let i = $index
  ) {
    <li
      class="w-3/4 rounded bg-slate-200 flex items-center px-2 py-2 text-xs text-slate-700"
    >
      <input
        type="text"
        class="flex-1 bg-transparent focus:outline-none"
        [value]="policy"
        (input)="updateItem('product_policies', i, $any($event.target).value)"
        placeholder="Policy detail"
      />

      <button
        type="button"
        class="ml-2 text-red-400 hover:text-red-600"
        (click)="removeItem('product_policies', i)"
      >
        ✕
      </button>
    </li>
  }

  <li>
    <button
      type="button"
      class="w-3/4 rounded border border-dashed border-slate-400 text-xs text-slate-500 py-2 hover:bg-slate-100"
      (click)="addItem('product_policies')"
    >
      + Add policy
    </button>
  </li>
</ul>

          </section>

          <hr class="my-6 border-slate-300" />

          <!-- COMMENTS -->
          <div class="space-y-4">
            <div class="flex gap-3">
              <div class="w-12 h-12 rounded-full bg-slate-200"></div>
              <div class="flex-1 space-y-2">
                <div class="h-3 w-24 rounded bg-slate-200"></div>
                <div class="h-3 w-full rounded bg-slate-200"></div>
                <div class="h-3 w-5/6 rounded bg-slate-200"></div>
              </div>
            </div>

            <p class="text-xs text-slate-400">
              Customer reviews will appear here
            </p>
          </div>
          <div
            class="mt-10 flex justify-end gap-4 border-t border-slate-300 pt-6"
          >
            <button
              type="submit"
              [disabled]="loading || form.invalid"
              class="px-6 py-3 rounded-lg bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-700 transition disabled:opacity-50"
            >
              @if (loading) {
                Saving…
              } @else {
                Publish Product
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
